#!/bin/bash

# Define variables
GITLAB_URL="https://gitlab.com/your-group/your-project.git"
GITHUB_URL="https://github.com/lithesheeli/second-migration.git"
OUTPUT_DIR="tmp/migrate"
NAMESPACE="gitlab github migration"
PROJECT="second-project"
BRANCHES=("main" "dev" "feature-branch-1" "feature-branch-2") # Add all branches you want to migrate

# Clone the GitLab repository
git clone $GITLAB_URL temp-repo
cd temp-repo

# Iterate over each branch
for BRANCH in "${BRANCHES[@]}"; do
  # Checkout the branch
  git checkout $BRANCH

  # Run the migration command
  gh actions-importer migrate gitlab \
    --target-url $GITHUB_URL \
    --output-dir $OUTPUT_DIR/$BRANCH \
    --namespace $NAMESPACE \
    --project $PROJECT

  # Copy the generated workflows to the GitHub repository
  mkdir -p ../github-repo/.github/workflows/$BRANCH
  cp -r $OUTPUT_DIR/$BRANCH/.github/workflows/* ../github-repo/.github/workflows/$BRANCH/

  # Push the workflows to the GitHub repository
  cd ../github-repo
  git checkout $BRANCH || git checkout -b $BRANCH
  git add .github/workflows/$BRANCH
  git commit -m "Add GitHub Actions workflows for branch $BRANCH"
  git push origin $BRANCH
  cd ../temp-repo
done

# Clean up
cd ..
rm -rf temp-repo github-repo $OUTPUT_DIR
